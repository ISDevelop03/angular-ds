<div id="ds-file-list" [ngClass]="className">
  <div *ngFor="let file of files" class="flex flex-col gap-1 mt-1">
    <!-- Neutral status file -->
    <div *ngIf="!file.status"
      class="relative border border-neutral-100 bg-level-3 rounded-lg p-4 flex gap-4 items-center justify-between">
      <div class="flex items-center justify-start gap-4">
        <div class="flex items-center justify-center p-2 bg-level-4 border border-stroke-1 rounded text-neutral-500">
          <ds-icon id="file-edit-02" size="16px" class="text-red-500"></ds-icon>
        </div>
        <div class="flex flex-col gap-1 text-neutral-900">
          <p class="text-[1rem]/[1.375rem] font-medium">
            {{ file.file.name }}
          </p>
          <p class="text-[0.875rem]/[1.25rem] font-normal">
            {{ formatFileSize(file.file.size) }} - 100% Téléchargé
          </p>
        </div>
      </div>

      <div *ngIf="isDownloadable">
        <button (click)="downloadFile(file?.file)" class="p-2 hover:bg-neutral-25 rounded">
          <ds-icon id="download" size="20px" class="shrink-0 text-red-500"></ds-icon>
        </button>
      </div>
    </div>
    <!-- Success status file -->
    <div *ngIf="file.status === 'success'"
      class="relative border border-success-500 rounded-lg p-4 flex gap-4 items-center justify-between">
      <div class="flex items-center justify-start gap-4">
        <div
          class="flex items-center justify-center rounded p-2 bg-[#FFFFFF] border border-success-200 text-success-500">
          <ds-icon id="file-edit-02" size="16px"></ds-icon>
        </div>
        <div class="flex flex-col gap-1">
          <p class="text-[1rem]/[1.375rem] font-medium text-success-500">
            {{ file.file.name }}
          </p>
          <p class="text-[0.875rem]/[1.25rem] font-normal text-neutral-700">
            {{ formatFileSize(file.file.size) }} - 100% Téléchargé
          </p>
        </div>
      </div>
      <div *ngIf="!isDownloadable">
        <button (click)="removeFile(file?.file.id)"
          class="rounded hover:bg-neutral-25 flex items-center justify-center p-1">
          <ds-icon id="trash-02" size="20" class="shrink-0 text-neutral-700"></ds-icon>
        </button>
      </div>
      <div *ngIf="isDownloadable">
        <button (click)="downloadFile(file?.file)" class="p-2 hover:bg-gray-50 rounded-full">
          <ds-icon id="download" size="16px" class="shrink-0"></ds-icon>
        </button>
      </div>
    </div>

    <!-- Uploading status file -->
    <div *ngIf="file.status === 'uploading'"
      class="relative border overflow-hidden border-red-200 bg-transparent rounded-lg p-4">
      <div class="absolute inset-0 h-full bg-red-50 dark:bg-[#290505] w-1/4 transition-all duration-300 ease-in-out"
        [style.width]="file.progress + '%'"></div>
      <div class="relative w-full z-[1] flex gap-4 items-center justify-start">
        <div class="flex items-center justify-center rounded bg-white border border-red-100 p-2 text-red-500">
          <ds-icon id="file-edit-02" size="16px"></ds-icon>
        </div>

        <div class="flex flex-col gap-1 text-neutral-700">
          <p class="text-[1rem]/[1.375rem] font-medium">
            {{ file.file.name }}
          </p>
          <p class="text-[0.875rem]/[1.25rem] font-normal">
            {{ formatFileSize(file.file.size) }}
          </p>
        </div>
        <div class="absolute right-0 top-1/2 -translate-y-1/2">
          <svg class="w-8 h-8 -rotate-90" viewBox="0 0 36 36">
            <circle class="text-red-100 dark:text-red-900" stroke="currentColor" stroke-width="3" fill="none" cx="18"
              cy="18" r="15" />
            <circle class="text-red-500 transition-all duration-300 ease-in-out" stroke="currentColor" stroke-width="3"
              stroke-linecap="round" fill="none" cx="18" cy="18" r="15" [attr.stroke-dasharray]="94.2"
              [attr.stroke-dashoffset]="94.2 - (94.2 * file.progress) / 100" />
          </svg>
        </div>
      </div>
    </div>

    <!-- Error status file -->
    <div *ngIf="file.status === 'error'">
      <div class="relative border border-error-300 rounded-lg p-4 bg-error-50 dark:bg-[#290505]">
        <div class="flex items-center justify-between gap-4">
          <div class="flex items-center gap-4">
            <div
              class="flex items-center justify-center rounded bg-white dark:bg-red-50 text-error-500 p-2 border border-error-100">
              <ds-icon id="file-edit-02" size="16px"></ds-icon>
            </div>
            <div class="flex flex-col gap-0.5 text-error-500">
              <p class="text-[1rem]/[1.375rem] font-medium">
                {{ file.file.name }}
              </p>
              <p class="text-neutral-700 text-[0.875rem]/[1.25rem] font-normal">
                {{ (file.file.size / 1024 / 1024).toFixed(2) }} Mo - 100%
                Téléchargé
              </p>
              <!-- <button (click)="reUploadFile(file.file.id)" class="max-w-fit inline-block font-medium text-error-500 hover:text-error-700">
                Réessayer
              </button> -->
            </div>

          </div>
          <button (click)="removeFile(file.file.id)"
            class="rounded-full text-rose-700 flex items-center justify-center w-5 h-5">
            <ds-icon id="trash-02" size="20px" class="shrink-0"></ds-icon>
          </button>
        </div>
        <div *ngIf="file.errors && file.errors.length > 0" class="mt-3">
          <div class="overflow-hidden">
            <button type="button"
              class="w-full text-left transition-colors duration-200 flex items-center justify-start gap-x-2"
              (click)="toggleErrors(file.file.id)">
              <ds-icon [id]="isErrorVisible(file.file.id) ? 'arrow-up' : 'arrow-down'" size="16px"
                class="transition-transform duration-200"
                [ngClass]="{ 'rotate-180': isErrorVisible(file.file.id) }"></ds-icon>
              <span class="font-medium text-sm text-black">Merci de consulter ci-dessous les erreurs identifiées au
                niveau
                de votre fichier</span>
            </button>

            <div *ngIf="isErrorVisible(file.file.id)" class="mt-2" [ngClass]="{
                'max-h-0 overflow-hidden': !isErrorVisible(file.file.id),
                'max-h-96 overflow-y-auto': isErrorVisible(file.file.id)
              }" style="transition: max-height 0.3s ease-in-out">
              <ul class="space-y-1">
                <li *ngFor="let error of file.errors" class="flex items-start gap-2 text-rose-700">
                  <ds-icon id="dash" size="16px" class="text-error-500 mt-0.5 flex-shrink-0"></ds-icon>
                  <span class="text-sm">{{ error }}</span>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>